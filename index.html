<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç·Šæ€¥åœ°éœ‡é€Ÿå ±ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</title>
<style>
body {
  font-family:"Yu Gothic","YuGothic","ãƒ¡ã‚¤ãƒªã‚ª",sans-serif;
  white-space: pre-wrap;
  margin: 5px;
  padding: 5px;
  background: #fff;
  font-size: 14px;
  line-height: 1.4;
}
#eew { margin: 0; padding: 0; }
#status { font-size: 12px; margin-bottom: 5px; }
#copyBtn { font-size: 12px; padding: 2px 5px; margin-bottom: 5px; cursor: pointer; }
</style>
</head>
<body>
<div id="status">æ›´æ–°ä¸­...</div>
<button id="copyBtn">æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>
<pre id="eew">èª­ã¿è¾¼ã¿ä¸­...</pre>

<script>
const outputEl = document.getElementById("eew");
const statusEl = document.getElementById("status");
const copyBtn = document.getElementById("copyBtn");

let lastText = "", lastBg = "";

async function updateEEW() {
  try {
    const res = await fetch("https://api.wolfx.jp/jma_eew.json");
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();

    if (data.isTraining) {
      outputEl.textContent = "è¨“ç·´å ±ã®ãŸã‚å‡¦ç†çµ‚äº†";
      return;
    }

    const maxInt = data.MaxIntensity ?? "ä¸æ˜";
    const isWarn = data.isWarn;

    // éœ‡åº¦ãƒãƒƒãƒ”ãƒ³ã‚°
    const intensityMap = {
      "1":"ğŸŸ¦", "2":"ğŸŸ¦",
      "3":"ğŸŸ¨", "4":"ğŸŸ¨",
      "5-":"ğŸŸ¥", "5+":"ğŸŸ¥", "5å¼±":"ğŸŸ¥", "5å¼·":"ğŸŸ¥",
      "6-":"ğŸŸª", "6+":"ğŸŸª", "6å¼±":"ğŸŸª", "6å¼·":"ğŸŸª", "7":"ğŸŸª"
    };
    const symbol = intensityMap[maxInt] || "ã€Šã€‹";
    let coloredTitle = symbol + data.Title + symbol;

    // æ³¨æ„æ–‡
    let eewNotice = "";
    if (["5-","5+","5å¼±","5å¼·"].includes(maxInt)) {
      eewNotice = `ï¼Šã€€ï¼Šã€€ï¼Š
ç·Šæ€¥åœ°éœ‡é€Ÿå ±ã§ã™ã€‚éœ‡åº¦${maxInt}ã®å¼·ã„æºã‚ŒãŒãã¾ã™ã€‚
ãŸã ã¡ã«èº«ã®å®‰å…¨ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚
è½ã¡ã¦ãã‚‹ã‚‚ã®ã‚„å€’ã‚Œã‚„ã™ã„ã‚‚ã®ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
å®‰å…¨ãŒç¢ºä¿ã§ããŸã‚‰ã€ãƒ†ãƒ¬ãƒ“ã‚„ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç­‰ã§æœ€æ–°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
æºã‚ŒãŒãŠã•ã¾ã£ã¦ã‹ã‚‰ç«ã®å§‹æœ«ãªã©ã‚’ã—ã¦ãã ã•ã„ã€‚
æ´¥æ³¢ã®å¯èƒ½æ€§ãŒã‚ã‚‹å ´åˆã¯æ²¿å²¸éƒ¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚`;
    } else if (["6-","6+","6å¼±","6å¼·","7"].includes(maxInt)) {
      let maxIntEn = maxInt==="6å¼±"?"6 lower":maxInt==="6å¼·"?"6 upper":maxInt;
      eewNotice = `ï¼Šã€€ï¼Šã€€ï¼Š
ç·Šæ€¥åœ°éœ‡é€Ÿå ±ã§ã™ã€‚éœ‡åº¦${maxInt}ã®éå¸¸ã«å¼·ã„æºã‚ŒãŒãã¾ã™ã€‚
ãŸã ã¡ã«èº«ã®å®‰å…¨ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚é ­ã‚’å®ˆã£ã¦ãã ã•ã„ã€‚
è½ã¡ã¦ãã‚‹ã‚‚ã®ã‚„å€’ã‚Œã‚„ã™ã„ã‚‚ã®ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
å®‰å…¨ãŒç¢ºä¿ã§ããŸã‚‰ã€ãƒ†ãƒ¬ãƒ“ã‚„ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç­‰ã§æœ€æ–°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
æºã‚ŒãŒãŠã•ã¾ã£ã¦ã‹ã‚‰ç«ã®å§‹æœ«ãªã©ã‚’ã—ã¦ãã ã•ã„ã€‚
===
Emergency Earthquake Warning. Very strong shaking of intensity ${maxIntEn} is expected. Take immediate action to protect yourself.`;
    } else {
      eewNotice = "ä»Šå¾Œã®æƒ…å ±ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚";
    }

    // æœ¬æ–‡ä½œæˆ
    let eewMessage = coloredTitle + "\n" + (data.isFinal ? `#ç¬¬${data.Serial}(æœ€çµ‚)å ±` : `#ç¬¬${data.Serial}å ±`);
    if (data.isCancel) eewMessage += "\nã“ã®ç·Šæ€¥åœ°éœ‡é€Ÿå ±ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚";

    const hypocenter = data.Hypocenter ?? "éœ‡æºåœ°ä¸æ˜";
    const magnitude = data.Magunitude ?? "ä¸æ˜";
    const depth = data.Depth ?? "ä¸æ˜";
    eewMessage += `\n${hypocenter} ã§åœ°éœ‡\næ¨å®šæœ€å¤§éœ‡åº¦ ${maxInt}\nM${magnitude}\néœ‡æºã®æ·±ã•:${depth}km`;

    if (data.WarnArea && data.WarnArea.length>0) {
      const chiikiList = data.WarnArea.map(a=>a.Chiiki).join(", ");
      eewMessage += `\nã€å¯¾è±¡åœ°åŸŸã€‘\n${chiikiList}`;
    }

    const originStr = data.OriginTime ? new Date(data.OriginTime).toLocaleString("ja-JP",{timeZone:"Asia/Tokyo"}) : "ç™ºç”Ÿæ™‚åˆ»ä¸æ˜";
    const announceDate = data.AnnouncedTime ? new Date(data.AnnouncedTime) : null;
    const announceStr = announceDate ? announceDate.toLocaleTimeString("ja-JP",{timeZone:"Asia/Tokyo"}) : "ç™ºè¡¨æ™‚åˆ»ä¸æ˜";
    eewMessage += `\n\n${originStr} ç™ºç”Ÿ\n${announceStr} æ°—è±¡åºç™ºè¡¨`;

    // èƒŒæ™¯è‰²æ›´æ–°
    let bgColor = data.isFinal ? "#ffffff" : "#f3cccb";
    if (lastBg !== bgColor) {
      document.body.style.background = bgColor;
      lastBg = bgColor;
    }

    // DOMæ›´æ–°ï¼ˆå¤‰åŒ–ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
    const fullText = eewMessage + "\n" + eewNotice;
    if (lastText !== fullText) {
      outputEl.textContent = fullText;
      lastText = fullText;
    }

    // æ›´æ–°æ—¥æ™‚
    statusEl.textContent = "æœ€çµ‚æ›´æ–°: " + new Date().toLocaleString("ja-JP");

  } catch(e) {
    outputEl.textContent = "å–å¾—ã‚¨ãƒ©ãƒ¼: " + e.message;
  }
}

// åˆå›æ›´æ–° & 2ç§’ã”ã¨
updateEEW();
setInterval(updateEEW, 2000);

// ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
copyBtn.addEventListener("click", () => {
  navigator.clipboard.writeText(outputEl.textContent).then(() => {
    const original = copyBtn.textContent;
    copyBtn.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†";
    setTimeout(()=>{ copyBtn.textContent = original },1500);
  }).catch(err=>alert("ã‚³ãƒ”ãƒ¼å¤±æ•—: "+err));
});
</script>
</body>
</html>
