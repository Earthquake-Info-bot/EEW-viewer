<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç·Šæ€¥åœ°éœ‡é€Ÿå ±ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼v1.4.1</title>
<style>
body {
  font-family:"Yu Gothic","YuGothic","ãƒ¡ã‚¤ãƒªã‚ª",sans-serif;
  white-space: pre-wrap;
  margin: 5px;
  padding: 5px;
  background: #fff;
  font-size: 14px;
  line-height: 1.4;
}
#eew { 
  margin: 0; 
  padding: 0; 
  font-family:"Yu Gothic","YuGothic","ãƒ¡ã‚¤ãƒªã‚ª",sans-serif;
}
#status { 
  font-size: 12px; 
  margin-bottom: 0px; 
}
#copyBtn {
  font-size: 12px;
  padding: 2px 5px;
  margin-bottom: 0px;
  cursor: pointer;
}
</style>
</head>
<body>
<div id="status">æ›´æ–°ä¸­...</div>
<button id="copyBtn">æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>
<pre id="eew">èª­ã¿è¾¼ã¿ä¸­...</pre>

<script>
const outputEl = document.getElementById("eew");
const statusEl = document.getElementById("status");
const copyBtn = document.getElementById("copyBtn");

async function updateEEW() {
  try {
    const res = await fetch("https://api.wolfx.jp/jma_eew.json");
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();

    let eewMessage = "";
    let eewNotice = "";

    if (data.isTraining) {
      outputEl.textContent = "è¨“ç·´å ±ã®ãŸã‚å‡¦ç†çµ‚äº†";
      
    // æœ€ä¸Šéƒ¨ã«æ›´æ–°æ—¥æ™‚
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth()+1).padStart(2,'0');
    const d = String(now.getDate()).padStart(2,'0');
    const h = String(now.getHours()).padStart(2,'0');
    const min = String(now.getMinutes()).padStart(2,'0');
    const s = String(now.getSeconds()).padStart(2,'0');
    statusEl.textContent = `æœ€çµ‚æ›´æ–°: ${y}/${m}/${d} ${h}:${min}:${s}`;
      
      return;
    }

    const maxInt = data.MaxIntensity ?? "ä¸æ˜";
    const isWarn = data.isWarn;
    let coloredTitle = data.Title;

    if (["1","2"].includes(maxInt)) {
      coloredTitle = isWarn ? `ğŸŸ¥${data.Title}ğŸŸ¥` : `ğŸŸ¦${data.Title}ğŸŸ¦`;
    } else if (["3","4"].includes(maxInt)) {
      coloredTitle = isWarn ? `ğŸŸ¥${data.Title}ğŸŸ¥` : `ğŸŸ¨${data.Title}ğŸŸ¨`;
    } else if (["5-","5+","5å¼±","5å¼·"].includes(maxInt)) {
      coloredTitle = `ğŸŸ¥${data.Title}ğŸŸ¥`;
      eewNotice += `ï¼Šã€€ï¼Šã€€ï¼Š
ç·Šæ€¥åœ°éœ‡é€Ÿå ±ã§ã™ã€‚éœ‡åº¦${maxInt}ã®å¼·ã„æºã‚ŒãŒãã¾ã™ã€‚
ãŸã ã¡ã«èº«ã®å®‰å…¨ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚
è½ã¡ã¦ãã‚‹ã‚‚ã®ã‚„å€’ã‚Œã‚„ã™ã„ã‚‚ã®ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
å®‰å…¨ãŒç¢ºä¿ã§ããŸã‚‰ã€ãƒ†ãƒ¬ãƒ“ã‚„ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç­‰ã§æœ€æ–°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
æºã‚ŒãŒãŠã•ã¾ã£ã¦ã‹ã‚‰ç«ã®å§‹æœ«ãªã©ã‚’ã—ã¦ãã ã•ã„ã€‚
éœ‡æºãŒæµ·åº•ã®å ´åˆã€æ´¥æ³¢ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ²¿å²¸éƒ¨ã§ã¯ã€å¿µã®ãŸã‚æ´¥æ³¢ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚`;
    } else if (["6-","6å¼±","6+","6å¼·","7"].includes(maxInt)) {
      coloredTitle = `ğŸŸª${data.Title}ğŸŸª`;
        let maxIntEn = "";
          if (maxInt === "6å¼±") maxIntEn = "6 lower";
          else if (maxInt === "6å¼·") maxIntEn = "6 upper";
          else if (maxInt === "7") maxIntEn = "7";
          else maxIntEn = maxInt; // 6- / 6+ ã®å ´åˆ
      eewNotice += `ï¼Šã€€ï¼Šã€€ï¼Š
ç·Šæ€¥åœ°éœ‡é€Ÿå ±ã§ã™ã€‚éœ‡åº¦${maxInt}ã®éå¸¸ã«å¼·ã„æºã‚ŒãŒãã¾ã™ã€‚
ãŸã ã¡ã«èº«ã®å®‰å…¨ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚é ­ã‚’å®ˆã£ã¦ãã ã•ã„ã€‚
è½ã¡ã¦ãã‚‹ã‚‚ã®ã‚„å€’ã‚Œã‚„ã™ã„ã‚‚ã®ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
å®‰å…¨ãŒç¢ºä¿ã§ããŸã‚‰ã€ãƒ†ãƒ¬ãƒ“ã‚„ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç­‰ã§æœ€æ–°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
æºã‚ŒãŒãŠã•ã¾ã£ã¦ã‹ã‚‰ç«ã®å§‹æœ«ãªã©ã‚’ã—ã¦ãã ã•ã„ã€‚
ï¼ï¼ï¼
Emergency Earthquake Warning. Very strong shaking of intensity ${maxIntEn} is expected. Take immediate action to protect yourself.`;
    } else {
      coloredTitle = `ã€Š${data.Title}ã€‹`;
      eewNotice += `ä»Šå¾Œã®æƒ…å ±ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚`;
    }

    eewMessage += coloredTitle;

    const serialText = data.isFinal ? `#ç¬¬${data.Serial}(æœ€çµ‚)å ±` : `#ç¬¬${data.Serial}å ±`;
    document.body.style.background = data.isFinal ? "#ffffff" : "#f3cccb";
    eewMessage += `\n${serialText}\n`;

    if (data.isCancel) eewMessage += "\nã“ã®ç·Šæ€¥åœ°éœ‡é€Ÿå ±ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚";

    if (data.isAssumption) {
      const hypocenter = data.Hypocenter ?? "éœ‡æºåœ°ä¸æ˜";
      eewMessage += `
PLUMæ³•ã«ã‚ˆã‚‹ç·Šæ€¥åœ°éœ‡é€Ÿå ±
${hypocenter} ã§æºã‚Œ
æ¨å®šæœ€å¤§éœ‡åº¦ ${maxInt}`;
    } else {
      const hypocenter = data.Hypocenter ?? "éœ‡æºåœ°ä¸æ˜";
      const magnitude = (data.Magunitude != null) ? Number(data.Magunitude).toFixed(1) : "ä¸æ˜";      const depth = data.Depth ?? "ä¸æ˜";
      eewMessage += `
${hypocenter} ã§åœ°éœ‡
æ¨å®šæœ€å¤§éœ‡åº¦ ${maxInt}
M${magnitude}
éœ‡æºã®æ·±ã•:${depth}km`;
    }

    if (data.WarnArea && data.WarnArea.length>0) {
      const chiikiList = data.WarnArea.map(a=>a.Chiiki).join(", ");
      eewMessage += `\nã€å¯¾è±¡åœ°åŸŸã€‘\n${chiikiList}`;
    }

    const tz = "Asia/Tokyo";
    const originStr = data.OriginTime
      ? (() => {
          const d = new Date(data.OriginTime);
          const yyyy = d.getFullYear();
          const MM = String(d.getMonth() + 1).padStart(2, '0');
          const dd = String(d.getDate()).padStart(2, '0');
          const HH = String(d.getHours()).padStart(2, '0');
          const mm = String(d.getMinutes()).padStart(2, '0');
          const ss = String(d.getSeconds()).padStart(2, '0');
          return `${yyyy}/${MM}/${dd} ${HH}:${mm}:${ss}`;
        })()
      : "ç™ºç”Ÿæ™‚åˆ»ä¸æ˜";
    const announceDate = data.AnnouncedTime ? new Date(data.AnnouncedTime) : null;
    const announceStr = announceDate
      ? `${String(announceDate.getDate()).padStart(2,'0')}æ—¥${String(announceDate.getHours()).padStart(2,'0')}:${String(announceDate.getMinutes()).padStart(2,'0')}:${String(announceDate.getSeconds()).padStart(2,'0')}`
      : "ç™ºè¡¨æ™‚åˆ»ä¸æ˜";
    
    eewMessage += `\n\n${originStr}ç™ºç”Ÿ`;
    eewMessage += `\n${announceStr} æ°—è±¡åºç™ºè¡¨`;
    
    if (eewNotice===""){
      outputEl.textContent = eewMessage;
    } else {
      outputEl.textContent = eewMessage + "\n" + eewNotice;
    }

    // æœ€ä¸Šéƒ¨ã«æ›´æ–°æ—¥æ™‚
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth()+1).padStart(2,'0');
    const d = String(now.getDate()).padStart(2,'0');
    const h = String(now.getHours()).padStart(2,'0');
    const min = String(now.getMinutes()).padStart(2,'0');
    const s = String(now.getSeconds()).padStart(2,'0');
    statusEl.textContent = `æœ€çµ‚æ›´æ–°: ${y}/${m}/${d} ${h}:${min}:${s}`;
    
  } catch(e) {
    outputEl.textContent = "å–å¾—ã‚¨ãƒ©ãƒ¼: " + e.message + (e.stack ? "\n" + e.stack : "");
  }
}

updateEEW();
setInterval(updateEEW, 2000);

// ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
copyBtn.addEventListener("click", () => {
  const text = outputEl.textContent; // ã‚³ãƒ”ãƒ¼å¯¾è±¡
  navigator.clipboard.writeText(text).then(() => {
    const originalText = copyBtn.textContent; // å…ƒã®ãƒœã‚¿ãƒ³æ–‡è¨€ã‚’ä¿å­˜
    copyBtn.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†"; // ä¸€æ™‚çš„ã«å¤‰æ›´
    setTimeout(() => { 
      copyBtn.textContent = originalText; // 1.5ç§’å¾Œã«å…ƒã«æˆ»ã™
    }, 1500);
  }).catch(err => {
    alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: " + err);
  });
});
</script>
</body>
</html>
